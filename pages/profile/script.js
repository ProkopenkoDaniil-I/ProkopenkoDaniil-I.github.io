"use strict";var n,e,t,o,s,l,u,r="https://academy.directlinedev.com";function i(){var e=document.querySelector(".menu__sign-in-btn_js"),n=document.querySelector(".menu__register-btn_js"),t=document.querySelector(".menu__my-profile-btn_js");localStorage.getItem("token")?(e.classList.add("header__menu-item_hidden"),n.classList.add("header__menu-item_hidden"),t.classList.remove("header__menu-item_hidden")):(e.classList.remove("header__menu-item_hidden"),n.classList.remove("header__menu-item_hidden"),t.classList.add("header__menu-item_hidden"))}function a(e,n,t,o,s,l){var e=0<arguments.length&&void 0!==e?e:null,n=1<arguments.length?n:void 0,t=2<arguments.length?t:void 0,i=3<arguments.length?o:void 0,s=4<arguments.length?s:void 0,r=5<arguments.length?l:void 0,a=document.querySelector(".".concat(n)),c=document.querySelector(".".concat(s)),t=document.querySelector(".".concat(t)),u=a.querySelector("input");function d(){m(a,i,c,r)}a&&t&&(e&&document.querySelector(".".concat(e)).addEventListener("click",function(){a.classList.add(i),u&&u.focus();c&&c.classList.add(r)}),t.addEventListener("click",d),window.addEventListener("keydown",function(e){27===e.keyCode&&a.classList.contains(i)&&d()}))}function m(e,n,t,o){t=2<arguments.length&&void 0!==t&&t,o=3<arguments.length?o:void 0;e.classList.remove(n),t&&t.classList.remove(o)}function d(e,n,t,o){t=2<arguments.length&&void 0!==t&&t,o=3<arguments.length?o:void 0;e.classList.add(n),t&&t.classList.add(o)}function p(e){var n=e.url,t=e.method,o=e.headers,e=e.body;return fetch(r+n+"?v=1.0.0",{method:void 0===t?"GET":t,headers:o,body:void 0===e?null:e})}function c(e,n){if(!e)return!1;var t=!0;return n.forEach(function(e){!function(e){e.classList.remove("text-input-field_invalid"),e.nextElementSibling.classList.add("hidden"),e.classList.add("text-input-field_valid"),e.nextElementSibling.nextElementSibling.classList.contains("hidden")&&e.nextElementSibling.nextElementSibling.classList.remove("hidden");e.nextElementSibling.nextElementSibling.nextElementSibling&&e.nextElementSibling.nextElementSibling.nextElementSibling.remove()}(e),e.isValid()||(t=!1,_(e))}),t}function f(e){return 5<e.length}function _(e){e.classList.add("text-input-field_invalid"),e.nextElementSibling.classList.remove("hidden"),e.nextElementSibling.nextElementSibling.classList.contains("hidden")||e.nextElementSibling.nextElementSibling.classList.add("hidden"),e.classList.contains("text-input-field_valid")&&e.classList.remove("text-input-field_valid")}function v(e,n){e.email.value=n.email,e.name.value=n.name,console.log("profile.name:",n.name),e.surname.value=n.surname,e.location.value=n.location,e.age.value=n.age}function g(){var e=document.querySelector(".preloader__loader_js");l++,e.classList.remove("preloader_hidden")}function y(){var e=document.querySelector(".preloader__loader_js");--l<=0&&(l=0,e.classList.add("preloader_hidden"))}function h(e){var n=document.querySelector(".myprofile__img-wrapper_js"),t=document.querySelector(".myprofile__name_js"),o=document.querySelector(".myprofile__surname_js"),s=document.querySelector(".myprofile__email_js"),l=document.querySelector(".myprofile__location_js"),i=document.querySelector(".myprofile__age_js");e.photoUrl.includes("default.jpg")?n.style.backgroundImage="url(".concat(r+e.photoUrl,") 50% 50%"):n.style.backgroundImage="url(".concat(r+e.photoUrl,")"),t.innerText=e.name,o.innerText=e.surname,s.innerText=e.email,l.innerText=e.location,i.innerText=e.age}function S(e,n,t){n=1<arguments.length&&void 0!==n?n:null,t=2<arguments.length&&void 0!==t?t:null;e.forEach(function(e){!function(e){e.classList.contains("text-input-field_invalid")&&e.classList.remove("text-input-field_invalid");e.classList.contains("text-input-field_valid")&&e.classList.remove("text-input-field_valid");e.nextElementSibling.nextElementSibling.classList.contains("hidden")||e.nextElementSibling.nextElementSibling.classList.add("hidden");e.nextElementSibling.classList.contains("hidden")||e.nextElementSibling.classList.add("hidden")}(e),e.value=""}),n&&((e=n).nextElementSibling.classList.contains("checkbox-input-error")&&e.nextElementSibling.classList.remove("checkbox-input-error"),n.checked=!1),t&&(t=t,(n=n).checked&&t.hasAttribute("disabled")&&t.removeAttribute("disabled"),n.checked||t.hasAttribute("disabled")||t.setAttribute("disabled",""))}document.querySelector(".".concat("menu__my-profile-btn_js")).classList.add("header__menu-item_current"),i(),a("edit-password-btn_js","edit-password-form_js","edit-password-form__close-btn_js","popup-form_open","edit-password-overlay_js","popup-overlay_open"),a("edit-data-btn_js","edit-data-form_js","edit-data-form__close-btn_js","popup-form_open","edit-data-overlay_js","popup-overlay_open"),a("mobile__menu-burger_js","popup-menu_js","header__popup-menu-close-btn_js","popup-menu_open"),a(null,"successfully-form_js","successfully-form__close-btn_js","popup-form_open","successfully-overlay_js","popup-overlay_open"),a(null,"unsuccessfully-form_js","unsuccessfully-form__close-btn_js","popup-form_open","unsuccessfully-overlay_js","popup-overlay_open"),(n=document.querySelector(".button-to-top_js"))&&(n.addEventListener("click",function(){window.scrollTo({top:0,behavior:"smooth"})}),window.addEventListener("scroll",function(e){1500<window.pageYOffset&&n.classList.remove("button-to-top_hidden"),window.pageYOffset<=1500&&n.classList.add("button-to-top_hidden")})),l=0,u=null,function(){var e=document.forms.editData,n=e.elements.email,t=e.elements.name,o=e.elements.surname,s=e.elements.location,l=e.elements.age;e.elements.submitButton;n.isValid=function(){return n.value.match(/^[0-9a-z-\.]+\@[0-9a-z-]{2,}\.[a-z]{2,}$/i)},t.isValid=function(){return!!t.value},o.isValid=function(){return!!o.value},s.isValid=function(){return!!s.value},l.isValid=function(){return e=l.value,!isNaN(e)&&null!==e&&0<e;var e};var i=[n,t,o,s,l],r=!1;e.addEventListener("submit",function(e){e.preventDefault(),c(r=!0,i)&&function(){var n=document.querySelector(".edit-data-form_js"),s=document.querySelector(".edit-data-overlay_js"),t=document.querySelector(".successfully-form_js"),o=document.querySelector(".successfully-overlay_js"),l=document.querySelector(".unsuccessfully-form_js"),i=document.querySelector(".unsuccessfully-overlay_js"),r=document.querySelector(".unsuccessfully-form__error-message_js");g();var a=document.forms.editData,e=new FormData(a);console.log("FormData:",e),p({method:"PUT",url:"/api/users",body:e,headers:{"x-access-token":localStorage.getItem("token")}}).then(function(e){return 401===e.status||403===e.status?(localStorage.removeItem("token"),localStorage.removeItem("userId"),void(location.pathname="/")):e.json()}).then(function(e){if(!e.success)throw console.log("Выкинули исключение"),e;console.log("Процесс завершился удачно"),h(u=e.data),m(n,"popup-form_open",s,"popup-overlay_open"),d(t,"popup-form_open",o,"popup-overlay_open"),v(a,u),setTimeout(function(){m(t,"popup-form_open",o,"popup-overlay_open")},2e3)}).catch(function(e){var t,o;console.log("Получили ошибку с сервера"),console.log("error:",e),console.log("error message:",e._message),e.errors&&(console.error(e.errors),t=e.errors,o=a,Object.keys(t).length&&Object.keys(t).forEach(function(e){var n=t[e];!function(e,n){_(e);var t=document.createElement("div");t.classList.add("text-input-error"),t.innerText=n,e.nextElementSibling.classList.contains("hidden")||e.nextElementSibling.classList.add("hidden");e.nextElementSibling.nextElementSibling.classList.contains("hidden")||e.nextElementSibling.nextElementSibling.classList.add("hidden");e.nextElementSibling.nextElementSibling.nextElementSibling?e.nextElementSibling.nextElementSibling.nextElementSibling.innerText=n:e.nextElementSibling.nextElementSibling.insertAdjacentElement("afterend",t)}(o.elements[e],n)})),e._message&&(r.innerText=e._message,m(n,"popup-form_open",s,"popup-overlay_open"),d(l,"popup-form_open",i,"popup-overlay_open"),setTimeout(function(){m(l,"popup-form_open",i,"popup-overlay_open")},2e3))}).finally(function(){y()})}()}),i.forEach(function(e){e.addEventListener("input",function(){c(r,i)})})}(),function(){var e=document.forms.editPassword,n=e.elements.oldPassword,t=e.elements.newPassword,o=e.elements.newPasswordRepeat;e.elements.submitButton;n.isValid=function(){return f(n.value)},t.isValid=function(){return f(t.value)},o.isValid=function(){return e=t.value,n=o.value,f(e)&&e===n;var e,n};var s=[n,t,o],l=!1;e.addEventListener("submit",function(e){e.preventDefault(),c(l=!0,s)&&function(){var n=document.querySelector(".edit-password-form_js"),t=document.querySelector(".edit-password-overlay_js"),o=document.querySelector(".successfully-form_js"),s=document.querySelector(".successfully-overlay_js"),l=document.querySelector(".unsuccessfully-form_js"),i=document.querySelector(".unsuccessfully-overlay_js"),r=document.querySelector(".unsuccessfully-form__error-message_js");g();var e=document.forms.editPassword,a=new FormData(e);console.log("FormData:",a);var c=[e.newPassword,e.oldPassword,e.newPasswordRepeat];p({method:"PUT",url:"/api/users",body:a,headers:{"x-access-token":localStorage.getItem("token")}}).then(function(e){return 401===e.status||403===e.status?(localStorage.removeItem("token"),localStorage.removeItem("userId"),void(location.pathname="/")):e.json()}).then(function(e){if(!e.success)throw e;console.log("Процесс завершился удачно"),h(u=e.data),S(c),m(n,"popup-form_open",t,"popup-overlay_open"),d(o,"popup-form_open",s,"popup-overlay_open"),setTimeout(function(){m(o,"popup-form_open",s,"popup-overlay_open")},2e3)}).catch(function(e){e._message?r.innerText=e._message:""===e._message&&(r.innerText="Unknown erorr"),S(c),m(n,"popup-form_open",t,"popup-overlay_open"),d(l,"popup-form_open",i,"popup-overlay_open"),setTimeout(function(){m(l,"popup-form_open",i,"popup-overlay_open")},2e3)}).finally(function(){y()})}()}),s.forEach(function(e){e.addEventListener("input",function(){c(l,s)})})}(),e=document.querySelector(".edit-data-btn_js"),t=document.forms.editData,o=document.querySelector(".sign-out-btn_js"),s=document.querySelector(".delete-account-btn_js"),i(),g(),p({method:"GET",url:"/api/users/".concat(localStorage.getItem("userId"))}).then(function(e){return e.json()}).then(function(e){e.success?h(u=e.data):location.pathname="/"}).finally(function(){y()}),e.addEventListener("click",function(){v(t,u)}),o.addEventListener("click",function(){confirm("You will exit from your account. Are you sure?")&&(console.log("You have signed out succeffully"),localStorage.removeItem("token"),localStorage.removeItem("userId"),location.pathname="/")}),s.addEventListener("click",function(){confirm("Your account will be DELETED. Are you sure?")&&(console.log("Your account has been deleted from database."),p({method:"DELETE",url:"/api/users/".concat(localStorage.getItem("userId")),headers:{"x-access-token":localStorage.getItem("token")}}).then(function(e){return 401===e.status||403===e.status?(localStorage.removeItem("token"),localStorage.removeItem("userId"),void(location.pathname="/")):e.json()}).then(function(e){e.success&&(alert("Your account has been deleted successfully"),localStorage.removeItem("token"),localStorage.removeItem("userId"),location.pathname="/")}).catch(function(e){console.log("Получили ошибку с сервера"),console.log("error:",e),console.log("error message:",e._message)}))});